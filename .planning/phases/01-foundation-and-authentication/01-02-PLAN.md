---
phase: 01-foundation-and-authentication
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - lib/auth/actions.ts
  - lib/auth/schemas.ts
  - app/(auth)/layout.tsx
  - app/(auth)/login/page.tsx
  - app/(auth)/reset-password/page.tsx
  - app/(auth)/update-password/page.tsx
  - app/(auth)/error/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can enter email and password on the login page and sign in"
    - "Invalid credentials show an error message on the login page"
    - "User can navigate to password reset from the login page"
    - "User can enter email on the reset page and receive a reset email"
    - "User clicking the reset email link lands on the update password page"
    - "User can set a new password on the update password page"
    - "Auth error page displays a clear error message with a link back to login"
  artifacts:
    - path: "lib/auth/actions.ts"
      provides: "Server Actions for login, resetPassword, updatePassword"
      exports: ["login", "resetPassword", "updatePassword"]
    - path: "lib/auth/schemas.ts"
      provides: "Zod validation schemas for auth forms"
      exports: ["loginSchema", "resetPasswordSchema", "updatePasswordSchema"]
    - path: "app/(auth)/layout.tsx"
      provides: "Auth route group layout -- minimal, no sidebar"
      contains: "ThemeProvider"
    - path: "app/(auth)/login/page.tsx"
      provides: "Login page with email/password form"
      contains: "login"
    - path: "app/(auth)/reset-password/page.tsx"
      provides: "Password reset request page"
      contains: "resetPassword"
    - path: "app/(auth)/update-password/page.tsx"
      provides: "New password entry page after reset link"
      contains: "updatePassword"
  key_links:
    - from: "app/(auth)/login/page.tsx"
      to: "lib/auth/actions.ts"
      via: "form action calls login server action"
      pattern: "login"
    - from: "lib/auth/actions.ts"
      to: "lib/supabase/server.ts"
      via: "creates server client for auth operations"
      pattern: "createClient"
    - from: "app/(auth)/login/page.tsx"
      to: "app/(auth)/reset-password/page.tsx"
      via: "Forgot password link"
      pattern: "reset-password"
---

<objective>
Build the auth flow UI pages (login, password reset request, update password) with server actions, form validation, and the Jack Dorsey-inspired minimal aesthetic. Mobile-first design.

Purpose: Users need a way to sign in to the scheduling app and recover forgotten passwords. No signup page exists per user decision -- members are pre-existing and invited by admin.

Output: Login page, password reset page, update password page, auth error page, server actions, and Zod validation schemas.
</objective>

<execution_context>
@/Users/chungweijian/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chungweijian/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-and-authentication/01-RESEARCH.md
@.planning/phases/01-foundation-and-authentication/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create auth server actions and validation schemas</name>
  <files>
    lib/auth/actions.ts
    lib/auth/schemas.ts
  </files>
  <action>
    1. Create `lib/auth/schemas.ts` -- Zod validation schemas:
       - `loginSchema`: email (string, email format, required), password (string, min 6 chars, required)
       - `resetPasswordSchema`: email (string, email format, required)
       - `updatePasswordSchema`: password (string, min 6 chars), confirmPassword (string, min 6 chars) with `.refine()` to ensure they match
       - Use Zod v4 syntax (already installed)

    2. Create `lib/auth/actions.ts` -- server actions with `'use server'` directive:

       **`login(prevState, formData)`** -- for use with `useActionState`:
       - Parse form data with `loginSchema`
       - If validation fails, return `{ error: "Invalid email or password format" }`
       - Call `supabase.auth.signInWithPassword({ email, password })`
       - If auth error, return `{ error: "Invalid email or password" }` (generic message for security)
       - On success: `revalidatePath('/', 'layout')` then `redirect('/')`

       **`resetPassword(prevState, formData)`** -- for use with `useActionState`:
       - Parse form data with `resetPasswordSchema`
       - If validation fails, return `{ error: "Please enter a valid email address" }`
       - Call `supabase.auth.resetPasswordForEmail(email, { redirectTo: SITE_URL + '/auth/callback?next=/update-password' })`
       - If error, return `{ error: "Could not send reset email. Please try again." }`
       - On success, return `{ success: "Check your email for a password reset link" }`
       - Do NOT redirect -- show success message on same page

       **`updatePassword(prevState, formData)`** -- for use with `useActionState`:
       - Parse form data with `updatePasswordSchema`
       - If validation fails, return `{ error: validation message }`
       - Call `supabase.auth.updateUser({ password })`
       - If error, return `{ error: "Could not update password. Please try again." }`
       - On success: `revalidatePath('/', 'layout')` then `redirect('/')`

       All actions return `{ error?: string, success?: string }` for consistent form state handling.

    Run `pnpm format` after creating files.
  </action>
  <verify>
    - `pnpm build` succeeds
    - `lib/auth/actions.ts` exports `login`, `resetPassword`, `updatePassword`
    - `lib/auth/schemas.ts` exports `loginSchema`, `resetPasswordSchema`, `updatePasswordSchema`
    - All server actions use `createClient` from `@/lib/supabase/server`
    - No usage of `getSession()` -- only server-side Supabase calls
  </verify>
  <done>
    Three server actions (login, resetPassword, updatePassword) exist with Zod validation, proper error handling, and consistent return types. All use the server Supabase client.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build auth pages with mobile-first Dorsey aesthetic</name>
  <files>
    app/(auth)/layout.tsx
    app/(auth)/login/page.tsx
    app/(auth)/reset-password/page.tsx
    app/(auth)/update-password/page.tsx
    app/(auth)/error/page.tsx
  </files>
  <action>
    1. Create `app/(auth)/layout.tsx` -- auth route group layout:
       - Minimal layout with NO sidebar, NO navigation chrome
       - Centered content area on a clean background
       - Use a simple flex container: `min-h-svh flex items-center justify-center`
       - Mobile: full-width with padding. Desktop: max-w-sm centered.
       - This layout wraps all auth pages (login, reset-password, update-password, error)

    2. Create `app/(auth)/login/page.tsx` -- login page:
       - **Design**: Jack Dorsey aesthetic -- black/white, minimal, sharp Inter typography, generous whitespace
       - App title/logo at top: "YM Serving" in bold, large text. Clean, no decorative elements.
       - Email input (type="email", required, placeholder "Email")
       - Password input (type="password", required, placeholder "Password")
       - Sign in button: full-width, black bg on light / white bg on dark, bold text
       - "Forgot your password?" link below the button, muted text, links to `/reset-password`
       - Use `useActionState` hook with the `login` server action
       - Display error message from action state (red text, subtle, below the form)
       - Show loading state on submit button via `useFormStatus` (pending state disables button, shows "Signing in...")
       - Use shadcn/ui `Input`, `Button`, `Label` components
       - Mark as `"use client"` for `useActionState` and `useFormStatus`
       - Touch targets: minimum 44px height on inputs and buttons for mobile
       - Use `sonner` toast for auth errors from URL params (e.g., redirected from middleware with error)

    3. Create `app/(auth)/reset-password/page.tsx` -- password reset request:
       - Same Dorsey aesthetic as login
       - Title: "Reset password"
       - Subtitle: "Enter your email and we'll send you a reset link"
       - Email input
       - "Send reset link" button (full-width, same style as login button)
       - Success message display: green-tinted card with "Check your email" message
       - Error message display: same pattern as login
       - "Back to sign in" link to `/login`
       - Use `useActionState` with `resetPassword` server action
       - `"use client"` directive

    4. Create `app/(auth)/update-password/page.tsx` -- set new password:
       - Title: "Set new password"
       - Two password inputs: "New password" and "Confirm password"
       - Minimum 6 characters hint text below first input
       - "Update password" button (full-width)
       - Error/success message display
       - Use `useActionState` with `updatePassword` server action
       - `"use client"` directive

    5. Create `app/(auth)/error/page.tsx` -- auth error page:
       - Server component (no `"use client"`)
       - Read `searchParams` for error type
       - Display a clear error message based on error code
       - "Back to sign in" link to `/login`
       - Minimal design, same aesthetic

    Run `pnpm format` after creating all files.
  </action>
  <verify>
    - `pnpm build` succeeds
    - `pnpm dev` starts without errors
    - Navigate to `http://localhost:3000/login` -- login page renders with email/password form
    - Navigate to `http://localhost:3000/reset-password` -- reset page renders
    - Navigate to `http://localhost:3000/update-password` -- update password page renders
    - All pages are mobile-first: full-width form on mobile, centered max-w-sm on desktop
    - Dark mode classes work (`dark:` prefixed styles render correctly)
  </verify>
  <done>
    Login page renders with email/password form, forgot password link, and error display. Password reset page accepts email and shows success/error messages. Update password page accepts new password with confirmation. Error page shows auth errors with link back to login. All pages follow mobile-first Dorsey aesthetic with black/white contrast, Inter typography, and generous whitespace.
  </done>
</task>

</tasks>

<verification>
1. `pnpm build` passes
2. All 7 files exist at specified paths
3. Login form submits to `login` server action and displays errors
4. Reset password form submits to `resetPassword` action and shows success message
5. Update password form validates matching passwords before submission
6. Auth layout has no sidebar -- just centered content
7. All pages use shadcn/ui components (Input, Button, Label)
8. Mobile-first: forms are full-width on small screens, constrained on desktop
9. No hardcoded strings for error messages in UI -- all come from server action returns
</verification>

<success_criteria>
- User can see and interact with login, password reset, and update password pages
- Server actions handle authentication with proper error messages
- Forms validate with Zod before hitting Supabase
- Pages follow the Jack Dorsey design aesthetic: minimal, monochromatic, sharp typography
- Mobile-first with proper touch targets
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-authentication/01-02-SUMMARY.md`
</output>
