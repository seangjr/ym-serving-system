---
phase: 02-teams-and-member-profiles
plan: 04
type: execute
wave: 3
depends_on: ["02-02", "02-03"]
files_modified:
  - app/(app)/team-roster/page.tsx
  - components/teams/roster-member-card.tsx
  - components/teams/roster-search.tsx
  - app/(app)/members/[memberId]/page.tsx
  - components/profiles/member-profile-view.tsx
autonomous: true

must_haves:
  truths:
    - "Team roster page shows all serving members (members who belong to at least one team)"
    - "Roster is searchable by name or email with real-time filtering"
    - "Each roster entry displays member name, avatar, teams, positions, and proficiency levels"
    - "Clicking a member opens their profile page showing name, positions, contact info, and teams"
    - "Member profile view page is accessible to all authenticated users"
  artifacts:
    - path: "app/(app)/team-roster/page.tsx"
      provides: "Team roster page with search and member grid"
      min_lines: 30
    - path: "components/teams/roster-member-card.tsx"
      provides: "Individual member card for roster display"
      min_lines: 30
    - path: "components/teams/roster-search.tsx"
      provides: "Search input for filtering roster"
      contains: "search"
    - path: "app/(app)/members/[memberId]/page.tsx"
      provides: "Public member profile view page"
      min_lines: 30
    - path: "components/profiles/member-profile-view.tsx"
      provides: "Member profile display component"
      contains: "getMemberProfile"
  key_links:
    - from: "app/(app)/team-roster/page.tsx"
      to: "lib/teams/queries.ts"
      via: "Data fetching with search parameter"
      pattern: "getTeamRoster|getTeams"
    - from: "app/(app)/members/[memberId]/page.tsx"
      to: "lib/profiles/queries.ts"
      via: "getMemberProfile for profile data"
      pattern: "getMemberProfile\\("
    - from: "components/teams/roster-member-card.tsx"
      to: "app/(app)/members/[memberId]/page.tsx"
      via: "Link to member profile"
      pattern: "href.*members/"
---

<objective>
Build the team roster page (searchable list of all serving members) and the member profile view page (for viewing another member's profile).

Purpose: Delivers PROF-01 (admin/lead adding members with positions), PROF-06 (viewing other members' profiles), and PROF-07 (searchable roster) -- the last requirements in Phase 2.

Output: Two page routes (/team-roster and /members/[memberId]) and three components for roster display, search, and profile viewing.
</objective>

<execution_context>
@/Users/chungweijian/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chungweijian/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-teams-and-member-profiles/02-RESEARCH.md
@.planning/phases/02-teams-and-member-profiles/02-01-SUMMARY.md
@.planning/phases/02-teams-and-member-profiles/02-02-SUMMARY.md
@.planning/phases/02-teams-and-member-profiles/02-03-SUMMARY.md
@lib/teams/queries.ts
@lib/profiles/queries.ts
@lib/auth/roles.ts
@components/teams/team-member-list.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Team roster page with search and member cards</name>
  <files>
    app/(app)/team-roster/page.tsx
    components/teams/roster-member-card.tsx
    components/teams/roster-search.tsx
  </files>
  <action>
**Add a getTeamRoster query** — Before building the UI, add a `getTeamRoster(searchQuery?: string)` function to `lib/teams/queries.ts` if it doesn't already exist from 02-01. This function should:
- Use createClient() (RLS-protected).
- Select from `members` with nested: `member_profiles(phone, avatar_url)`, `team_members!inner(id, team_id, role, serving_teams(id, name, color))`, `member_position_skills(proficiency, preference, team_positions(id, name, category))`.
- The `!inner` on team_members ensures only members who belong to at least one team are returned (serving members only).
- If searchQuery provided, apply `.or("full_name.ilike.%${searchQuery}%,email.ilike.%${searchQuery}%")`.
- Order by full_name.
- Return typed data.

**app/(app)/team-roster/page.tsx** — Server component with search:
- Accept searchParams from the page props (Next.js App Router pattern: `{ searchParams }: { searchParams: Promise<{ q?: string }> }`).
- Resolve searchParams with `await`.
- Call getTeamRoster(searchParams.q) to fetch filtered roster data.
- Fetch the list of teams via getTeams() for the filter sidebar/chips.
- Layout:
  - Page heading "Team Roster" with member count.
  - RosterSearch component for the search input.
  - Optional: Team filter chips (small buttons for each team name) that add `?team=teamId` to URL params. Filter results by team_members entries.
  - Responsive member grid: 1 col on mobile, 2 cols on md, 3 cols on lg, 4 cols on xl.
  - Each member as a RosterMemberCard.
  - Empty state: "No members found" with suggestion to refine search.

**components/teams/roster-search.tsx** — Client component ("use client"):
- Props: defaultValue (current search query from URL).
- Renders shadcn/ui Input with search icon (Search from lucide-react).
- On input change, debounce 300ms, then update URL search params using `useRouter().replace()` with the new `?q=...` value.
- Use `useSearchParams()` and `usePathname()` from next/navigation.
- Clear button (X icon) when search has value.
- Wrap in Suspense boundary if needed for useSearchParams.

**components/teams/roster-member-card.tsx** — Client component ("use client"):
- Props: member object (id, full_name, email, avatar_url, teams array, positions/skills array).
- Card layout using shadcn/ui Card:
  - Avatar (shadcn Avatar with AvatarImage + AvatarFallback using initials).
  - Member name (bold, truncated).
  - Email (muted, truncated).
  - Team badges: one Badge per team with team color as accent.
  - Position chips: compact display of positions with proficiency (e.g., "Lead Vocals (Advanced)") using Badge with color based on proficiency.
  - If member is a team lead, show a subtle "Lead" indicator.
- Entire card is clickable, links to `/members/${member.id}` using Next.js Link.
- Hover state: subtle shadow increase.
  </action>
  <verify>
```bash
pnpm build 2>&1 | tail -10
ls app/\(app\)/team-roster/page.tsx components/teams/roster-member-card.tsx components/teams/roster-search.tsx
```
  </verify>
  <done>Team roster page shows all serving members in a searchable, responsive grid. Search filters by name/email with debounced URL params. Each member card shows avatar, name, team badges, and position/skill chips. Cards link to individual member profiles. PROF-07 (searchable roster) fully addressed.</done>
</task>

<task type="auto">
  <name>Task 2: Member profile view page for viewing other members</name>
  <files>
    app/(app)/members/[memberId]/page.tsx
    components/profiles/member-profile-view.tsx
  </files>
  <action>
**app/(app)/members/[memberId]/page.tsx** — Server component:
- Import getMemberProfile from profiles/queries.
- Extract memberId from route params.
- Fetch member profile via getMemberProfile(memberId).
- If member not found, call notFound() from next/navigation.
- Render MemberProfileView component with the profile data.
- Add a "Back to Roster" link at the top using a Button with ArrowLeft icon and Link to /team-roster.

**components/profiles/member-profile-view.tsx** — Server or client component (server is fine since it's read-only):
- Props: member object (full_name, email, avatar_url, phone, teams with roles, positions with skills).
- Layout: Two-column on desktop (lg:grid-cols-2), single column on mobile.
- **Left column:**
  - Large avatar (w-24 h-24 or similar) with Avatar component.
  - Name (heading, large).
  - Email with Mail icon (linked as mailto:).
  - Phone with Phone icon (if available, linked as tel:). If not available, show "Not provided" in muted text.
- **Right column / below on mobile:**
  - **Teams section:** Card listing each team the member belongs to, with role badge (Lead/Member), team color indicator. Each team name links to `/teams/${teamId}`.
  - **Positions & Skills section:** Card listing positions grouped by team, each with proficiency badge and preference badge. Same display pattern as position-preferences.tsx from 02-03 but for viewing another member.
  - Contact info visibility note: For now, all authenticated users can see all profile fields. The research recommended restricting phone/emergency contact to admin/committee and same-team members, but implementing that restriction adds complexity. Keep it simple for v1 — all authenticated users see everything. Add a comment noting this can be restricted later.

**Formatting:**
- Use date-fns `format()` for dates if join date is displayed.
- Use consistent badge colors matching the roster cards.
- Include proper empty states for each section if data is null/empty.
  </action>
  <verify>
```bash
pnpm build 2>&1 | tail -10
ls app/\(app\)/members/\[memberId\]/page.tsx components/profiles/member-profile-view.tsx
```
  </verify>
  <done>Member profile view page shows another member's full profile with avatar, contact info, teams, and positions/skills. Page is accessible to all authenticated users. Links back to roster page. PROF-06 (view other members' profiles) fully addressed.</done>
</task>

</tasks>

<verification>
After both tasks are complete:
1. `pnpm build` passes without errors
2. `pnpm lint` passes
3. `/team-roster` page renders with search and member grid
4. Search filters members by name/email via URL params
5. `/members/[memberId]` page renders full member profile
6. Clicking a roster card navigates to member profile
7. "Back to Roster" link returns to roster page
8. Both pages handle empty/null data gracefully
</verification>

<success_criteria>
- Team roster shows all serving members in responsive grid
- Search by name/email works with debounced filtering
- Member cards display avatar, teams, and positions with proficiency
- Member profile page shows name, contact info, teams, and skills
- Navigation between roster and member profiles works
- PROF-01, PROF-06, PROF-07 requirements addressed
- All Phase 2 requirements (TEAM-01 through TEAM-06, PROF-01 through PROF-07) fully covered across all four plans
</success_criteria>

<output>
After completion, create `.planning/phases/02-teams-and-member-profiles/02-04-SUMMARY.md`
</output>
